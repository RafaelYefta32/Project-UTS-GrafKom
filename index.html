<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Visualisasi Insertion Sort</title>

    <!-- Tailwind CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Tetap gunakan style.css -->
    <link rel="stylesheet" href="style.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
  </head>

  <body
    class="bg-gradient-to-br from-white via-sky-50 to-blue-100 text-gray-800 flex flex-col gap-6 p-6 h-screen font-[Plus_Jakarta_Sans]"
  >
    <!-- Judul -->
    <div
      class="title text-3xl font-semibold text-center text-transparent bg-clip-text bg-gradient-to-r from-sky-600 via-blue-600 to-indigo-700 drop-shadow-sm"
    >
      Visualisasi Insertion Sort
    </div>

    <!-- Kontainer utama -->
    <div class="main-container flex flex-1 gap-6">
      <!-- Kiri -->
      <div
        class="left flex-1 rounded-2xl bg-white shadow-xl border border-blue-200 flex items-center justify-center"
      >
        <canvas id="canva1" class="rounded-lg w-full h-full"></canvas>
      </div>

      <!-- Kanan -->
      <div
        class="right w-[25%] rounded-2xl bg-white shadow-xl border border-blue-200 p-6 flex flex-col justify-between"
      >
        <div class="right-col1 flex flex-col gap-5">
          <div class="text-xl font-semibold text-blue-700 mb-2">
            Pengaturan
          </div>

          <!-- Input N -->
          <div class="flex flex-col gap-2">
            <label for="inputN" class="text-sm font-medium text-gray-700"
              >Jumlah Elemen Random (N):</label
            >
            <input
              type="number"
              id="inputN"
              min="1"
              value="5"
              class="border border-gray-300 rounded-lg px-3 py-2 transition-all focus:ring-2 focus:ring-sky-400 focus:border-sky-400 outline-none shadow-sm hover:shadow-md"
            />
            <div class="flex gap-2 mt-2">
              <button
                id="manyDuplicateBtn"
                class="flex-1 px-2 py-1 bg-sky-400 text-white text-sm rounded-md shadow-sm"
              >
                Banyak Duplikat
              </button>
              <button
                id="uniqueBtn"
                class="flex-1 px-2 py-1 bg-sky-400 text-white text-sm rounded-md shadow-sm"
              >
                Unik
              </button>
            </div>
          </div>

          <!-- Input A -->
          <div class="flex flex-col gap-2">
            <label for="inputA" class="text-sm font-medium text-gray-700"
              >Nilai Manual (A):</label
            >
            <input
              type="text"
              id="inputA"
              value="10,20,30,40,50"
              class="border border-gray-300 rounded-lg px-3 py-2 transition-all focus:ring-2 focus:ring-sky-400 focus:border-sky-400 outline-none shadow-sm hover:shadow-md"
            />
            <p class="text-xs text-gray-500 italic">
              Gunakan koma untuk memisahkan nilai (contoh: 10,20,30)
            </p>
          </div>

          <div class="flex flex-col gap-3 mt-3">
            <!-- Dropdown Arah -->
            <select
              id="sortDirection"
              class="border border-gray-300 rounded-md px-3 py-2 text-sm focus:ring-2 focus:ring-sky-400 outline-none shadow-sm hover:shadow-md transition-all"
            >
              <option value="asc">Ascending</option>
              <option value="desc">Descending</option>
            </select>

            <!-- Tombol Sort & Sorted -->
            <div class="flex gap-3">
              <button
                id="sortedBtn"
                class="flex-1 py-2 rounded-md text-sm font-semibold text-white bg-gradient-to-r from-blue-500 to-sky-500 hover:scale-105 transition-transform shadow-md hover:shadow-blue-400/50"
              >
                Sorted
              </button>

              <button
                id="sortBtn"
                class="flex-1 py-2 rounded-md text-sm font-semibold text-white bg-gradient-to-r from-blue-500 to-sky-500 hover:scale-105 transition-transform shadow-md hover:shadow-blue-400/50"
              >
                Sort
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="script.js"></script>
    <script src="transform.js"></script>
    <script src="transform_komposit.js"></script>

    <script src="script.js"></script>
    <script src="transform.js"></script>
    <script src="transform_komposit.js"></script>

    <script>
      function setupCanvas(canvas) {
        const rect = canvas.getBoundingClientRect();
        canvas.width = rect.width;
        canvas.height = rect.height;
        return canvas.getContext("2d");
      }

      const canvas = document.getElementById("canva1");
      let ctx = setupCanvas(canvas);

      var cnv = canvas;

      const btnManyDuplicate = document.getElementById("manyDuplicateBtn");
      const btnUnique = document.getElementById("uniqueBtn");

      const inputN = document.getElementById("inputN");
      const inputA = document.getElementById("inputA");

      function drawBars(ctx, data) {
        const width = ctx.canvas.getBoundingClientRect().width;
        const height = ctx.canvas.getBoundingClientRect().height;
        const color = { r: 109, g: 197, b: 255 };

        ctx.clearRect(0, 0, width, height);

        if (data.length === 0) {
          return;
        }

        let imageDataA = ctx.getImageData(0, 0, width, height);

        const barWidth = 30;
        const spacing = 15;

        const totalWidth = data.length * barWidth + (data.length - 1) * spacing;

        const availableWidth = width * 0.9;

        let scale = 1.0;
        if (totalWidth > availableWidth) {
          scale = availableWidth / totalWidth;
        }

        const s = { x: scale, y: 1.0 };

        const offsetY = height * 0.8;
        const titik_putar = { x: width / 2, y: offsetY };

        const startX = (width - totalWidth) / 2;

        const maxValue = Math.max(...data) > 0 ? Math.max(...data) : 1;
        const scaleHeight = (height * 0.4) / maxValue;

        let barNumber = [];

        for (let i = 0; i < data.length; i++) {
          const value = data[i];
          const barHeight = value * scaleHeight;

          const x1_base = Math.floor(startX + i * (barWidth + spacing));
          const y1_base = Math.floor(offsetY - barHeight);
          const x2_base = Math.floor(x1_base + barWidth);
          const y2_base = Math.floor(offsetY);

          const p1_transform = skalaFP(
            { x: x1_base, y: y1_base },
            titik_putar,
            s
          );
          const p2_transform = skalaFP(
            { x: x2_base, y: y2_base },
            titik_putar,
            s
          );

          const x1 = Math.floor(p1_transform.x);
          const y1 = Math.floor(p1_transform.y);
          const x2 = Math.floor(p2_transform.x);
          const y2 = Math.floor(p2_transform.y);

          for (let x = x1 + 1; x < x2; x++) {
            dda_line(
              imageDataA,
              x,
              y2 - 1,
              x,
              y1 + 1,
              color.r,
              color.g,
              color.b
            );
          }

          dda_line(imageDataA, x1, y1, x2, y1, 0, 0, 0);
          dda_line(imageDataA, x2, y1, x2, y2, 0, 0, 0);
          dda_line(imageDataA, x2, y2, x1, y2, 0, 0, 0);
          dda_line(imageDataA, x1, y2, x1, y1, 0, 0, 0);

          const text_base = { x: x1_base + barWidth / 2, y: offsetY + 15 };
          const text_transform = skalaFP(text_base, titik_putar, s);

          barNumber.push({
            text: value,
            x: text_transform.x,
            y: text_transform.y,
          });
        }

        ctx.putImageData(imageDataA, 0, 0);

        ctx.fillStyle = "#000";
        ctx.font = "14px Arial";
        ctx.textAlign = "center";
        barNumber.forEach((numberInfo) => {
          ctx.fillText(numberInfo.text, numberInfo.x, numberInfo.y);
        });
      }

      let data = [];
      for (let i = 0; i < 5; i++) {
        data.push(Math.floor(Math.random() * 50));
      }
      drawBars(ctx, data);

      inputN.addEventListener("input", (e) => {
        const n = Number(e.target.value);
        if (n > 0) {
          data = Array.from({ length: n }, () =>
            Math.floor(Math.random() * 50)
          );
        } else {
          data = [];
        }
        drawBars(ctx, data);
      });

      inputA.addEventListener("input", (e) => {
        data = e.target.value
          .split(",")
          .map((n) => parseFloat(n))
          .filter((v) => !isNaN(v));
        drawBars(ctx, data);
      });

      btnManyDuplicate.addEventListener("click", () => {
        console.log("tes");
        const n = Number(inputN.value);
        const range = Math.max(Math.floor(n / 2), 1);
        data = Array.from({ length: n }, () =>
          Math.floor(Math.random() * range)
        );
        drawBars(ctx, data);
      });

      btnUnique.addEventListener("click", () => {
        const n = Number(inputN.value);
        const maxValue = n * 2;
        let uniqueSet = new Set();
        while (uniqueSet.size < n) {
          uniqueSet.add(Math.floor(Math.random() * maxValue) + 1);
        }
        data = Array.from(uniqueSet);
        drawBars(ctx, data);
      });
    </script>
  </body>
</html>
